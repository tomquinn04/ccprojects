-- loader/loader

-- VARIABLES

if not shell.dir() == "loader" then shell.setDir("loader") end

function initialsetup()
    print("Performing initial setup")
    if not fs.exists("loader/config") then

        shell.run("rm", "../setup")
        shell.run("wget", "https://tomquinn04.github.io/ccprojects/loader/initfiles")
        
        os.loadAPI("loader/initfiles")
        dl = initfiles.get()

        for i,fn in ipairs(dl) do
            shell.run("wget", fn)
        end
        os.unloadAPI("loader/initfiles")
    end

end

function runprogram()
    os.loadAPI("loader/config")
    program = config.file
    os.unloadAPI("loader/config")
    
    os.loadAPI("loader/utilities")
    os.loadAPI(program.."/def")
    shell.setDir(program)
    utilities.dllist(def.files)
    utilities.runonce(def.runonce, def.runonceargs)

-- MAIN

if not fs.exists("loader/initfiles") then initialsetup() end

